---
date: "2016-04-27T00:00:00Z"
external_link: ""
image:
  focal_point: Smart
  preview_only: true
links:
summary: |-
  
  With our eye for details, we noticed that product performance subtly differed across state lines. Higher temperatures clearly drove product failure in California, but the relationship was murkier in Florida.
  
  We prioritize client time and comprehension. As the problem expanded in complexity, so did our models. An important part of our work is unpacking the results for actionable insights. This helped us and our client to quickly zero in on a root cause and develop new product recommendations.
  
  Click for more on how we report complexity with clarity.
tags:
- Problem
title: Straightforward answers from complex models
share: false
profile: false
comments: false
reading_time: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
library(kableExtra)
library(ggplot2)
library(tidyverse)
library(effects)
library(ecodatamisc)
demo_dat <- read.csv("demo.csv")
demo_dat$response = as.factor(demo_dat$Product_success)
dat2 = subset(demo_dat,State=="California")
dat3 = subset(demo_dat,State=="Florida")
bg = "#1b2724"
wh = "#ffffff"
pl = "#6eb39c"
```

<img src="featured.png" style="border-radius: 5%;" />

<style>
p.caption {
  font-size: 0.8em;
  padding: 0px 0px 40px 0px;
}
</style>

## Uncovering hidden complexities

Our client’s initial hunch was that temperature alone drove product failure. With additional analyses, our data scientists found that the impact of temperature on product performance depended on state.

<img src="analyst.jpg" style="border-radius: 5%;" />

Breaking down the client’s question like this added tricky nuances to our results.

## What is the answer?

We value the time of our clients. Good product teams want to get into specifics, and the specifics are our strong suit. But “highlights” convey key results quickly without getting lost in the nitty gritty details.

When reporting to clients, we like to walk through the models used to draw conclusions. Some model outputs are easy to interpret – like bar graphs or time series. But as problems become more complex so do the analyses and their outputs.

One such tool is the binomial GLM, which used with yes/no data like our client provided. The outputs can be tricky to visualize, and tricker when different segments arise in the data such as geography. Our consultants worked closely with the client explain these outputs comprehensively, but clearly.

## A case study: leveraging simple yes/no surveys

Placeholder text

A client has provided us with 49 growers reporting success or failure of a product. We’ve enriched the survey with additional environmental data performed a statistical analysis. It looks like relatively cold temperatures negatively impact product performance.

```{r bar, fig.cap="Simple bar chart showing the overall results from end-user survey on agrochemical success following product application. A plot like this provides a useful summary but loses valuable detail."}
demo_dat %>%
  group_by(Product_success) %>%
  summarize(value = n()) %>%
  ggplot(aes(x = Product_success, y = value)) +
    geom_bar(stat = 'identity', fill = pl) +
    labs(title = '', x = '\nQuestion:\n\nWas the product effective?', y = 'Survey response count\n') +
    ylim(0,80) +
    theme_ecodata() +
    theme(
      panel.background = element_rect(fill=bg, colour=NA),
      plot.background = element_rect(fill=bg, colour=NA),
      axis.line = element_line(colour=wh),
      axis.text = element_text(colour=wh),
      axis.title.x = element_text(colour=wh),
      axis.title.y = element_text(colour=wh),
      panel.border = element_rect(colour=wh,fill=NA)
    )
```

But how can we know for sure? And when exactly is it too hot and when is it ok to use the product? We can just count the number of 'yes' and 'no' responses. But that doesn’t tell us how confident we are, or where the temperature cut-offs lie.

## Solving the problem with binomial GLMs

The simplest way to interpret these models is that a steep, S-shaped curve is a strong correlation between product performance and temperature. A flatter curve is a weak correlation.

In California, the results are very clear. The client can advise their end-users to save their herbicide at high temperatures as the risk-adjusted cost of failing to spray is very low. We’re very confident it would just be a waste.

```{r cali, fig.cap="Probability of agrochemical product success in response to daily maximum temperatures on farms in California only. High temperatures significantly impacted product performance (p < 0.001). Each dot represents a survey response."}
mod2 = glm(response ~ Daily_high_temp, family=binomial, data=dat2)
eff2 = allEffects(se=TRUE, xlevels=100, mod=mod2) %>%
  as.data.frame()

ggplot(data=eff2$Daily_high_temp,aes(x=Daily_high_temp, y=fit))+
  geom_line(linewidth=1,colour=pl) +
  geom_ribbon(aes(ymin=fit-se, ymax=fit+se),alpha=.2,fill=pl) +
  geom_hline(yintercept=0.75,colour=wh,linetype="dashed") +
  scale_y_continuous(labels=scales::percent) +
  labs(title = '', x = '\nDaily max. temp. (F)\n\nCalifornia', y = 'Product success (%)\n') +
  theme_ecodata() +
  theme(
    panel.background = element_rect(fill=bg, colour=NA),
    plot.background = element_rect(fill=bg, colour=NA),
    axis.line = element_line(colour=wh),
    axis.text = element_text(colour=wh),
    axis.title.x = element_text(colour=wh),
    axis.title.y = element_text(colour=wh),
    panel.border = element_rect(colour=wh,fill=NA)
  ) +
  geom_point(data=dat2, aes(x=Daily_high_temp, y=as.double(response)-1), position=position_jitter(w=0.05, h=0), alpha=.3, colour=pl)
```

Reported product failures show up along the bottom of the plot (0%) and successes are at the top (100%), represented by dots at different temperatures.

```{r calibox, fig.cap="The product fell below the client's key success rate of 75% (horizontal line) once temperatures exceeded 86F. Shaded region indicates uncertainty: tighter shading indicates higher confidence."}
mod2 = glm(response ~ Daily_high_temp, family=binomial, data=dat2)
eff2 = allEffects(se=TRUE, xlevels=100, mod=mod2) %>%
  as.data.frame()

ggplot(data=eff2$Daily_high_temp,aes(x=Daily_high_temp, y=fit))+
  geom_line(linewidth=1,colour=pl) +
  geom_ribbon(aes(ymin=fit-se, ymax=fit+se),alpha=.2,fill=pl) +
  scale_y_continuous(labels=scales::percent) +
  labs(title = '', x = '\nDaily max. temp. (F)\n\nCalifornia', y = 'Product success (%)\n') +
  theme_ecodata() +
  theme(
    panel.background = element_rect(fill=bg, colour=NA),
    plot.background = element_rect(fill=bg, colour=NA),
    axis.line = element_line(colour=wh),
    axis.text = element_text(colour=wh),
    axis.title.x = element_text(colour=wh),
    axis.title.y = element_text(colour=wh),
    panel.border = element_rect(colour=wh,fill=NA)
  ) +
  geom_point(data=dat2, aes(x=Daily_high_temp, y=as.double(response)-1), position=position_jitter(w=0.05, h=0), alpha=.3, colour=pl)  +
  geom_rect(aes(xmin = 75, xmax = 95, ymin = .25, ymax = .975), 
          fill = "NA", alpha = 0.4, color = wh, linewidth = 1.5)
```

This area is where we figure out what the thresholds are. The product begins to fail at at low rates just below 80F, when the shaded confidence ribbon drops below 100%. By 88F the success rate dropped below the client's key threshold of 75% and beyond 103F the product no longer succeeded at all.

On the other hand, we’re much less confident about how temperature impacts the product for growers in Florida. Something else is causing product failure in this state.

```{r fl, fig.cap="Probability of agrochemical product success in response to daily maximum temperatures on farms in Florida only."}
mod3 = glm(response ~ Daily_high_temp, family=binomial, data=dat3)
eff3 = allEffects(se=TRUE, xlevels=100, mod=mod3) %>%
  as.data.frame()

ggplot(data=eff3$Daily_high_temp,aes(x=Daily_high_temp, y=fit))+
  geom_line(linewidth=1,colour=pl) +
  geom_ribbon(aes(ymin=fit-se, ymax=fit+se),alpha=.2,fill=pl) +
  scale_y_continuous(labels=scales::percent) +
  labs(title = '', x = '\nDaily max. temp. (F)\n\nFlorida', y = 'Product success (%)\n') +
  theme_ecodata() +
  theme(
    panel.background = element_rect(fill=bg, colour=NA),
    plot.background = element_rect(fill=bg, colour=NA),
    axis.line = element_line(colour=wh),
    axis.text = element_text(colour=wh),
    axis.title.x = element_text(colour=wh),
    axis.title.y = element_text(colour=wh),
    panel.border = element_rect(colour=wh,fill=NA)
  ) +
  geom_point(data=dat3, aes(x=Daily_high_temp, y=as.double(response)-1), position=position_jitter(w=0.05, h=0), alpha=.3, colour=pl)
```

With a confidence (measured with p-value) of 0.82, there’s a 82% risk that higher temperatures *don’t* affect the product. In other words, advising end-users to save their herbicide at high temperatures might lead to pest damage that could’ve been avoided.

This kind of uncertainty is ok – uncertainty is critical to know and allows clients to price risk, like the risk of telling end-users the wrong thing to do. If the cost of pest damage are high, then it might make sense to spray just in case. But if the cost of pest damage is low, the risk-adjusted cost of wasting herbicide might be higher.

## Distilling things down to actionable insights

Here we would suggest that our client provide confident advice to end-users in states like Nebraska with clear patterns in the data. Above 88F, don’t waste the product. Less accidental waste means more satisfied customers.

For end-users in Florida, their advice should be transparent but qualified. They wouldn’t want to bet the farm on it (no pun intended). A result like this justifies a closer look for the product team or maybe warning salespeople that there is a small risk of high temperatures messing up the product.

<img src="thinking.jpg" style="border-radius: 5%;" />

Our client wanted to know exactly when their Pennsylvanian customers should spray, so we dug even deeper and found the answer in cloud cover.

(Links to other pages)

